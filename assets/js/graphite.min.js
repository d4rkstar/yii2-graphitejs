(function(a){a.fn.graphite=function(b){if(b==="update"){a.fn.graphite.update(this,arguments[1]);return this}b=b||{};var c=a.extend({},a.fn.graphite.defaults,b);return this.each(function(){var d=a(this);d.data("graphOptions",c);a.fn.graphite.render(d,c)})};a.fn.graphite.geturl=function(c){var d=c.url+"?";var b=a.extend({},c);b._t=b._t||Math.random();a.each(b,function(e,f){if(e==="target"){a.each(f,function(g,h){d+="&target="+h})}else{if(f!==null&&e!=="url"){d+="&"+e+"="+f}}});return d.replace(/\?&/,"?")};a.fn.graphite.render=function(c,b){c.attr("src",a.fn.graphite.geturl(b));c.attr("height",b.height);c.attr("width",b.width)};a.fn.graphite.update=function(c,b){b=b||{};c.each(function(){var e=a(this);var d=a.extend({},e.data("graphOptions"),b);e.data("graphOptions",d);a.fn.graphite.render(e,d)})};a.fn.graphite.defaults={from:"-1hour",height:"300",until:"now",url:"/render/",width:"940"}}(jQuery));